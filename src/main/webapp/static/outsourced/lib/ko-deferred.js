/*
 Deferred Updates plugin for Knockout http://knockoutjs.com/
 (c) Michael Best, Steven Sanderson
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 3.0.0
*/
(function(a){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?a(require("knockout")):"function"===typeof define&&define.amd?define(["knockout"],a):a(ko)})(function(a){function t(b,a){for(var c in b)if(b.hasOwnProperty(c)&&b[c]&&0<=b[c].toString().indexOf(a))return c}function q(b,a){for(var c in b)if(b.hasOwnProperty(c)&&b[c]===a)return c}function R(b,a,c,d){var h=b.subscribe(a,null,"dirty",!1,d),f=b.subscribe(c,null,"change",!1,d);return{dispose:function(){h.dispose();
f.dispose()},target:b}}var C="object"===typeof global&&global?global:window,F=void 0;a.tasks=function(){function b(b){var c=0;try{for(var a=b;a=a._next;)u=a,a._done||(a._done=!0,a._func.apply(a.object,a.args||[]),c++)}finally{if(b!==f)b._next=null,n=b;else{m=[];f._next=null;e=n=f;if(h)C[d](h);h=F}u=F}return c++}function H(){if(!u)return b(f)}var c,d;C.setImmediate?(c="setImmediate",d="clearImmediate"):(c="setTimeout",d="clearTimeout");var h,f={},n=f,m=[],u,e=f,g={processImmediate:function(a,c,H){m.push(e);
e=n;try{return a.apply(c,H||[])}finally{try{e._next&&b(e)}finally{e=m.pop()||f}}},processDelayed:function(a,b,d){2==arguments.length&&"object"==typeof b&&(d=b,b=d.distinct);var k;if(k=b||b===F)a:{k=u||e;for(var f;f=k._next;k=f)if(f._func===a&&!f._done){k._next=f._next;k._next||(n=k);k=!0;break a}k=!1}f=d||{};f._func=a;n=n._next=f;m.length||h||(h=C[c](H));return!k},makeProcessedCallback:function(b){return function(){return g.processImmediate(b,this,arguments)}}};a.processDeferredBindingUpdatesForNode=
a.processAllDeferredBindingUpdates=function(){for(var b=f;b=b._next;)b.node&&!b._done&&(b._done=!0,b._func.call())};a.processAllDeferredUpdates=H;a.evaluateAsynchronously=function(b,a){return setTimeout(g.makeProcessedCallback(b),a)};return g}();a.utils.objectForEach||(a.utils.objectForEach=function(b,a){for(var c in b)b.hasOwnProperty(c)&&a(c,b[c])});a.utils.objectMap||(a.utils.objectMap=function(b,a){if(!b)return b;var c={},d;for(d in b)b.hasOwnProperty(d)&&(c[d]=a(b[d],d,b));return c});var g=function(b,
a){for(var c in b)if(b.hasOwnProperty(c)&&b[c]&&b[c][a])return b[c]}(a,"end"),S=t(g,".apply(")||"ignore",K=t(g,":[]"),L=t(g,".length"),v=a.computed,T=q(a,v),I=q(v.fn,v),d=a.computed(function(){}),U=q(d,d.peek)||"peek",V=q(d,d.isActive)||"isActive",W=q(d,d.getDependenciesCount),M=q(d,!1),X=q(d,d.dispose),N="disposeWhenNodeIsRemoved",O="disposeWhen";if("hasWriteFunction"!=M){var d=v.toString(),y;if(y=d.match(/.\.disposeWhenNodeIsRemoved\s*\|\|\s*.\.([^|\s,]+)/))N=y[1];if(d=d.match(/.\.disposeWhen\s*\|\|\s*.\.([^|\s,]+)/))O=
d[1]}var Y=t(a.utils,"documentElement)")||t(a.utils,"ocument)"),d=a.subscribable.fn;y=t(d,".bind(");var A=(new a.subscribable).subscribe(),P=A.dispose,Q=A.constructor.prototype,Z=q(Q,P);A.dispose();var A=null,s=[],$=0;g[K]=function(b){s.push(b)};g.end=function(){s.pop()};g[L]=function(b){if(!a.isSubscribable(b))throw Error("Only subscribable things can act as dependencies");if(0<s.length){var d=s[s.length-1];d&&d(b,b._id=b._id||++$)}};a.ignoreDependencies=g[S]=function(b,a,c){try{return s.push(null),
b.apply(a,c||[])}finally{s.pop()}};var aa=d[y];d[y]=function(b,d,c,g,h){c=c||"change";var f;if(h)f=function(a){b(a,c)},"change"==c&&(this.dependents=this.dependents||[],this.dependents.push(h));else{var n=function(a){b.call(d,a,c)};f="change"!=c?n:function(b){w.deferUpdates&&!1!==m.deferUpdates||m.deferUpdates?a.tasks.processDelayed(n,{args:[b]}):n(b)}}var m=aa.call(this,f,null,c);m.target=this;m.event=c;m.dependent=h;m.deferUpdates=g;return m};var D=d.notifySubscribers,p;d.notifySubscribers=function(b,
a){if("change"===a||"dirty"===a||a===F)if(p)p.push([this,b,a]);else try{if(p=[],D.call(this,b,a),p.length)for(var c=0,d;d=p[c];c++)Function.prototype.call.apply(D,d)}finally{p=null}else D.call(this,b,a)};d.getDependents=function(){return this.dependents?[].concat(this.dependents):[]};Q[Z]=function(){P.call(this);this.dependent&&"change"==this.event&&a.utils.arrayRemoveItem(this.target.dependents,this.dependent)};var w=function(b,d,c){function q(){a.utils.objectForEach(B,function(a,b){b.dispose()});
a.utils.arrayForEach(y,function(a){a.dispose()});B={};p=0;y=[];r=l=!1}function h(b,c){var d="dirty"==c,f=d&&!r&&!l;d?r=!0:l=!0;(d=e.throttleEvaluation)&&0<=d?(clearTimeout(A),A=a.evaluateAsynchronously(u,d)):w.deferUpdates&&!1!==e.deferUpdates||e.deferUpdates?f=a.tasks.processDelayed(u,{node:E}):l&&(u(),f=!1);f&&e.notifySubscribers&&(e.notifySubscribers(x,"dirty"),!r&&d&&clearTimeout(A))}function f(a,b){r||l?l=!0:h(a,b)}function n(a,b){if(!B[b]){var c;c=a[I]===w?R(a,h,f,e):a.subscribe(h,null,"change",
!1,e);B[b]=c;p++}}function m(){if(D&&D()){if(!s)return G(),l=!1,!0}else s=!1}function u(b){if(k||!l&&!0!==b)r=l;else if(!m()){k=!0;try{var c=a.utils.objectMap(B,function(){return!0}),f=p;g[K](function(a,b){c[b]?(c[b]=F,f--):n(a,b)});var h=z.call(d);f&&a.utils.objectForEach(c,function(a,b){b&&(B[a].dispose(),delete B[a],p--)});r=l=!1;e.equalityComparer&&e.equalityComparer(x,h)||(e.notifySubscribers(x,"beforeChange"),x=h,e._latestValue=x,e.notifySubscribers(x))}finally{g.end(),r=l=k=!1}}}function e(){if(0<
arguments.length){if("function"===typeof t){var a=e.deferUpdates;e.deferUpdates=!1;try{t.apply(d,arguments)}finally{e.deferUpdates=a}}else throw Error('Cannot write a value to a ko.computed unless you specify a "write" option. If you wish to read the current value, don\'t pass any parameters.');return this}(l||r)&&u(!0);g[L](e);return x}function v(){return l||r||0<p}var x,r=!1,l=!0,k=!1,s=!1,z=b;z&&"object"==typeof z?(c=z,z=c.read):(c=c||{},z||(z=c.read));if("function"!=typeof z)throw Error("Pass a function that returns the value of the ko.computed");
var t=c.write;d||(d=c.owner);var B={},p=0,y=[],A=null,J,E=c[N]||c.disposeWhenNodeIsRemoved||null,C=c[O]||c.disposeWhen,D=C,G=q;E&&(s=!0,E.nodeType&&(D=function(){return!a.utils[Y](E)||C&&C()}));if(!m()&&!0!==c.deferEvaluation){k=!0;try{g[K](n),e._latestValue=x=z.call(d)}finally{g.end(),l=k=!1}}E&&v()&&(G=function(){a.utils.domNodeDisposal.removeDisposeCallback(E,G);q()},a.utils.domNodeDisposal.addDisposeCallback(E,G));a.subscribable.call(e);a.utils.extend(e,w.fn);e[U]=e.peek=function(){(l||r)&&u(!0);
return x};e[W]=e.getDependenciesCount=function(){return p};e[M]=e.hasWriteFunction="function"===typeof t;e[X]=e.dispose=function(){G()};e[V]=e.isActive=v;e.activeWhen=function(b){J||(J=a.computed(function(){k=!b();!k&&l&&h(F,"change")}),J.deferUpdates=!1,y.push(J))};e.getDependencies=function(){var b=[];a.utils.objectForEach(B,function(a,c){b.push(c.target)});return b};return e};w[I]=v[I];w.fn=v.fn;w.fn[I]=w;w.deferUpdates=!0;a[T]=a.computed=a.dependentObservable=w;v=d=null;a.extenders.throttle=function(b,
d){if(a.isWriteableObservable(b)){var c=null;return a.computed({read:b,write:function(g){clearTimeout(c);c=a.evaluateAsynchronously(function(){b(g)},d)}})}b.throttleEvaluation=d;return b};a.extenders.deferred=function(a,d){a.deferUpdates=d};return a});